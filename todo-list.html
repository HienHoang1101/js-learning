<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>üìù Todo List App v2.0 - Loops Practice</title>
    <style>
      /* ========== RESET & BI·∫æN M√ÄU S·∫ÆC ========== */
      /* D·∫•u * l√† ch·ªçn t·∫•t c·∫£ c√°c ph·∫ßn t·ª≠, reset margin v√† padding v·ªÅ 0, box-sizing cho d·ªÖ t√≠nh k√≠ch th∆∞·ªõc */
      *,
      *::before,
      *::after {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      /* ƒê·ªãnh nghƒ©a c√°c bi·∫øn m√†u s·∫Øc cho ch·∫ø ƒë·ªô s√°ng (light mode) */
      :root {
        --bg-primary: white; /* M√†u n·ªÅn ch√≠nh */
        --bg-secondary: #f8f9fa; /* M√†u n·ªÅn ph·ª• (cho c√°c khung) */
        --text-primary: #333; /* M√†u ch·ªØ ch√≠nh */
        --text-secondary: #666; /* M√†u ch·ªØ ph·ª• */
        --border-color: #ddd; /* M√†u vi·ªÅn */
        --accent-primary: #667eea; /* M√†u nh·∫•n ch√≠nh (t√≠m xanh) */
        --accent-hover: #764ba2; /* M√†u nh·∫•n khi hover (t√≠m ƒë·∫≠m) */
        --success: #4caf50; /* M√†u xanh l√° cho ho√†n th√†nh */
        --danger: #f44336; /* M√†u ƒë·ªè cho x√≥a */
        --warning: #ff9800; /* M√†u cam cho xu·∫•t d·ªØ li·ªáu */
        --shadow: 0 20px 60px rgba(0, 0, 0, 0.3); /* ƒê·ªï b√≥ng */
        --transition: all 0.3s; /* Hi·ªáu ·ª©ng chuy·ªÉn ƒë·ªông 0.3 gi√¢y */
      }

      /* Ch·∫ø ƒë·ªô t·ªëi (dark mode) - ghi ƒë√® l·∫°i c√°c bi·∫øn m√†u */
      .dark-mode {
        --bg-primary: #1a1a1a; /* N·ªÅn t·ªëi */
        --bg-secondary: #2d2d2d; /* N·ªÅn ph·ª• t·ªëi */
        --text-primary: #f8f9fa; /* Ch·ªØ s√°ng */
        --text-secondary: #aaa; /* Ch·ªØ ph·ª• s√°ng m·ªù */
        --border-color: #444; /* Vi·ªÅn t·ªëi */
        --accent-primary: #764ba2; /* ƒê·ªïi m√†u nh·∫•n cho ph√π h·ª£p */
        --accent-hover: #667eea;
      }

      body {
        font-family:
          "Segoe UI", Tahoma, Geneva, Verdana, sans-serif; /* Font ch·ªØ d·ªÖ ƒë·ªçc */
        background: linear-gradient(
          135deg,
          #667eea 0%,
          #764ba2 100%
        ); /* N·ªÅn gradient chuy·ªÉn m√†u */
        min-height: 100vh; /* Chi·ªÅu cao t·ªëi thi·ªÉu b·∫±ng to√†n m√†n h√¨nh */
        display: flex; /* S·ª≠ d·ª•ng flexbox ƒë·ªÉ cƒÉn gi·ªØa */
        justify-content: center; /* CƒÉn gi·ªØa theo chi·ªÅu ngang */
        align-items: center; /* CƒÉn gi·ªØa theo chi·ªÅu d·ªçc */
        padding: 20px; /* Kho·∫£ng c√°ch l·ªÅ 20px */
        color: var(--text-primary); /* M√†u ch·ªØ l·∫•y t·ª´ bi·∫øn */
        transition: var(--transition); /* Hi·ªáu ·ª©ng chuy·ªÉn m√†u khi ƒë·ªïi theme */
      }

      .dark-mode body {
        background: linear-gradient(
          135deg,
          #1a1a1a 0%,
          #2d2d2d 100%
        ); /* N·ªÅn gradient t·ªëi */
      }

      /* Khung ch·ª©a to√†n b·ªô n·ªôi dung */
      .container {
        width: 100%;
        max-width: 700px; /* Chi·ªÅu r·ªông t·ªëi ƒëa 700px */
        background: var(--bg-primary); /* N·ªÅn tr·∫Øng ho·∫∑c t·ªëi t√πy theme */
        border-radius: 15px; /* Bo g√≥c 15px */
        box-shadow: var(--shadow); /* ƒê·ªï b√≥ng */
        padding: 40px; /* Kho·∫£ng c√°ch b√™n trong 40px */
        transition: var(--transition); /* Hi·ªáu ·ª©ng khi ƒë·ªïi theme */
      }

      /* Ph·∫ßn header ch·ª©a ti√™u ƒë·ªÅ v√† n√∫t chuy·ªÉn theme */
      .header {
        display: flex;
        justify-content: space-between; /* CƒÉn hai ph·∫ßn t·ª≠ v·ªÅ hai ƒë·∫ßu */
        align-items: center; /* CƒÉn gi·ªØa theo chi·ªÅu d·ªçc */
        margin-bottom: 30px; /* Kho·∫£ng c√°ch ph√≠a d∆∞·ªõi 30px */
      }

      h1 {
        color: var(--text-primary);
        font-size: 32px;
        font-weight: 700;
      }

      .theme-toggle {
        background: var(--accent-primary);
        color: white;
        border: none; /* Kh√¥ng vi·ªÅn */
        border-radius: 20px; /* Bo tr√≤n */
        padding: 8px 16px;
        cursor: pointer; /* Con tr·ªè chu·ªôt d·∫°ng b√†n tay */
        font-size: 14px;
        transition: var(--transition);
      }

      .theme-toggle:hover {
        background: var(--accent-hover);
      }

      /* Khu v·ª±c nh·∫≠p v√† th√™m c√¥ng vi·ªác */
      .input-group {
        display: flex;
        gap: 10px; /* Kho·∫£ng c√°ch gi·ªØa c√°c ph·∫ßn t·ª≠ con */
        margin-bottom: 20px;
      }

      #todoInput {
        flex: 1; /* Chi·∫øm to√†n b·ªô kh√¥ng gian c√≤n l·∫°i */
        padding: 15px 20px;
        border: 2px solid var(--border-color);
        border-radius: 8px;
        font-size: 16px;
        background: var(--bg-primary);
        color: var(--text-primary);
        transition: var(--transition);
      }

      #todoInput:focus {
        outline: none; /* B·ªè vi·ªÅn m·∫∑c ƒë·ªãnh khi focus */
        border-color: var(--accent-primary); /* ƒê·ªïi m√†u vi·ªÅn khi focus */
      }

      #addButton {
        padding: 15px 30px;
        background: var(--accent-primary);
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: var(--transition);
        white-space: nowrap; /* Kh√¥ng xu·ªëng d√≤ng */
      }

      #addButton:hover {
        background: var(--accent-hover);
        transform: translateY(-2px); /* Nh·∫•c n√∫t l√™n 2px khi hover */
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
      }

      #addButton:active {
        transform: translateY(0); /* Tr·ªü l·∫°i v·ªã tr√≠ c≈© khi click */
      }

      /* Thanh ƒëi·ªÅu khi·ªÉn (b·ªô l·ªçc, t√¨m ki·∫øm) */
      .controls {
        display: flex;
        flex-wrap: wrap; /* Cho ph√©p xu·ªëng d√≤ng n·∫øu kh√¥ng ƒë·ªß ch·ªó */
        gap: 10px;
        margin-bottom: 20px;
        justify-content: space-between;
      }

      .filters {
        display: flex;
        gap: 8px;
      }

      .search-box {
        position: relative; /* ƒê·ªÉ ƒë·∫∑t icon t√¨m ki·∫øm b√™n trong */
      }

      #searchInput {
        padding: 10px 15px 10px 35px; /* Ch·ª´a ch·ªó b√™n tr√°i cho icon */
        border: 2px solid var(--border-color);
        border-radius: 20px;
        background: var(--bg-secondary);
        color: var(--text-primary);
        font-size: 14px;
        width: 200px;
        transition: var(--transition);
      }

      #searchInput:focus {
        outline: none;
        border-color: var(--accent-primary);
        width: 250px; /* M·ªü r·ªông khi focus */
      }

      .search-icon {
        position: absolute;
        left: 12px;
        top: 50%;
        transform: translateY(-50%); /* CƒÉn gi·ªØa theo chi·ªÅu d·ªçc */
        color: var(--text-secondary);
      }

      /* C√°c n√∫t chung (filter, sort, action) */
      .filter-btn,
      .sort-btn,
      .action-btn {
        padding: 8px 16px;
        background: var(--bg-secondary);
        border: 2px solid var(--border-color);
        border-radius: 20px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 500;
        transition: var(--transition);
        color: var(--text-primary);
      }

      .filter-btn:hover,
      .sort-btn:hover,
      .action-btn:hover {
        background: var(--accent-primary);
        color: white;
        border-color: var(--accent-primary);
      }

      /* N√∫t ƒëang ƒë∆∞·ª£c ch·ªçn (active) */
      .filter-btn.active,
      .sort-btn.active {
        background: var(--accent-primary);
        color: white;
        border-color: var(--accent-primary);
      }

      .sort-controls {
        display: flex;
        gap: 8px;
      }

      /* Danh s√°ch c√¥ng vi·ªác */
      .todo-list {
        list-style: none; /* B·ªè d·∫•u ƒë·∫ßu d√≤ng m·∫∑c ƒë·ªãnh c·ªßa th·∫ª ul */
        margin-top: 20px;
        min-height: 300px; /* Chi·ªÅu cao t·ªëi thi·ªÉu ƒë·ªÉ tr√°nh b·ªã co l·∫°i */
      }

      /* M·ªói c√¥ng vi·ªác */
      .todo-item {
        display: flex;
        align-items: center;
        padding: 15px;
        margin-bottom: 10px;
        background: var(--bg-secondary);
        border-radius: 8px;
        transition: var(--transition);
        border-left: 4px solid var(--accent-primary); /* Vi·ªÅn tr√°i m√†u t√≠m */
        cursor: grab; /* Con tr·ªè ki·ªÉu k√©o th·∫£ */
      }

      .todo-item:active {
        cursor: grabbing; /* Khi ƒëang k√©o */
      }

      .todo-item.dragging {
        opacity: 0.5; /* M·ªù ƒëi khi k√©o */
        transform: scale(0.98); /* Thu nh·ªè m·ªôt ch√∫t */
      }

      .todo-item:hover {
        transform: translateX(5px); /* Tr∆∞·ª£t sang ph·∫£i 5px khi hover */
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }

      /* C√¥ng vi·ªác ƒë√£ ho√†n th√†nh */
      .todo-item.completed {
        background: #e8f5e9; /* M√†u xanh nh·∫°t */
        border-left-color: var(--success);
      }

      .dark-mode .todo-item.completed {
        background: rgba(
          76,
          175,
          80,
          0.1
        ); /* Trong ch·∫ø ƒë·ªô t·ªëi, d√πng n·ªÅn trong su·ªët xanh */
      }

      .todo-checkbox {
        margin-right: 15px;
        width: 20px;
        height: 20px;
        cursor: pointer;
        accent-color: var(--success); /* M√†u checkbox khi ƒë∆∞·ª£c ch·ªçn */
      }

      .todo-text {
        flex: 1;
        font-size: 16px;
        color: var(--text-primary);
        transition: var(--transition);
      }

      .todo-item.completed .todo-text {
        color: var(--text-secondary);
        text-decoration: line-through; /* G·∫°ch ngang ch·ªØ */
      }

      .todo-actions {
        display: flex;
        gap: 8px;
      }

      .todo-btn {
        padding: 8px 12px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 500;
        transition: var(--transition);
      }

      .edit-btn {
        background: #2196f3; /* Xanh d∆∞∆°ng */
        color: white;
      }

      .edit-btn:hover {
        background: #0b7dda;
      }

      .delete-btn {
        background: var(--danger);
        color: white;
      }

      .delete-btn:hover {
        background: #e53935;
      }

      /* Th·ªëng k√™ */
      .stats {
        display: flex;
        justify-content: space-between;
        margin-top: 25px;
        padding: 15px;
        background: var(--bg-secondary);
        border-radius: 8px;
        font-size: 14px;
        color: var(--text-secondary);
      }

      /* Tr·∫°ng th√°i khi kh√¥ng c√≥ c√¥ng vi·ªác n√†o */
      .empty-state {
        text-align: center;
        padding: 60px 20px;
        color: var(--text-secondary);
      }

      .empty-state svg {
        width: 100px;
        height: 100px;
        margin-bottom: 15px;
        color: var(--border-color);
      }

      /* N√∫t xu·∫•t v√† nh·∫≠p d·ªØ li·ªáu */
      .export-import {
        display: flex;
        gap: 10px;
        margin-top: 15px;
      }

      .export-btn,
      .import-btn {
        flex: 1; /* C·∫£ hai n√∫t chi·∫øm ƒë·ªÅu chi·ªÅu r·ªông */
        padding: 10px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 500;
        transition: var(--transition);
      }

      .export-btn {
        background: var(--warning);
        color: white;
      }

      .export-btn:hover {
        background: #e68a00;
      }

      .import-btn {
        background: #9c27b0; /* M√†u t√≠m */
        color: white;
      }

      .import-btn:hover {
        background: #7b1fa2;
      }

      /* Responsive: ƒëi·ªÅu ch·ªânh cho m√†n h√¨nh nh·ªè (ƒëi·ªán tho·∫°i) */
      @media (max-width: 768px) {
        .container {
          padding: 20px;
        }

        .input-group {
          flex-direction: column; /* X·∫øp d·ªçc thay v√¨ ngang */
        }

        #addButton {
          width: 100%;
        }

        .controls {
          flex-direction: column;
        }

        .filters,
        .sort-controls {
          width: 100%;
          justify-content: center;
        }

        #searchInput {
          width: 100%;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>üìù My Todo List v2.0</h1>
        <button class="theme-toggle" id="themeToggle">üåô Dark Mode</button>
      </div>

      <div class="input-group">
        <input
          type="text"
          id="todoInput"
          placeholder="What needs to be done?"
          autocomplete="off"
        />
        <button id="addButton">Add Todo</button>
      </div>

      <div class="controls">
        <div class="filters">
          <button class="filter-btn active" data-filter="all">All</button>
          <button class="filter-btn" data-filter="active">Active</button>
          <button class="filter-btn" data-filter="completed">Completed</button>
        </div>

        <div class="search-box">
          <span class="search-icon">üîç</span>
          <input type="text" id="searchInput" placeholder="Search..." />
        </div>
      </div>

      <div class="controls">
        <div class="sort-controls">
          <button class="sort-btn active" data-sort="newest">Newest</button>
          <button class="sort-btn" data-sort="oldest">Oldest</button>
          <button class="sort-btn" data-sort="az">A-Z</button>
          <button class="sort-btn" data-sort="za">Z-A</button>
        </div>

        <button class="action-btn" id="clearCompleted">Clear Completed</button>
      </div>

      <ul id="todoList" class="todo-list">
        <!-- C√°c c√¥ng vi·ªác s·∫Ω ƒë∆∞·ª£c JavaScript ch√®n v√†o ƒë√¢y -->
      </ul>

      <div class="stats">
        <span id="totalCount">Total: 0</span>
        <span id="completedCount">Completed: 0</span>
        <span id="activeCount">Active: 0</span>
      </div>

      <div class="export-import">
        <button class="export-btn" id="exportBtn">üì§ Export</button>
        <button class="import-btn" id="importBtn">üì• Import</button>
      </div>
    </div>

    <script>
      // Todo App v2.0 - N√¢ng cao v·ªõi v√≤ng l·∫∑p v√† nhi·ªÅu t√≠nh nƒÉng h∆°n
      // ƒê√¢y l√† m·ªôt "l·ªõp" (class) trong JavaScript, gi√∫p t·ªï ch·ª©c code g·ªçn g√†ng.
      class TodoApp {
        // H√†m kh·ªüi t·∫°o (constructor) s·∫Ω t·ª± ƒë·ªông ch·∫°y khi t·∫°o ƒë·ªëi t∆∞·ª£ng m·ªõi t·ª´ class n√†y
        constructor() {
          // Kh·ªüi t·∫°o c√°c thu·ªôc t√≠nh (bi·∫øn) c·ªßa ·ª©ng d·ª•ng
          this.todos = []; // M·∫£ng ch·ª©a danh s√°ch c√°c c√¥ng vi·ªác (ban ƒë·∫ßu r·ªóng)
          this.currentFilter = "all"; // B·ªô l·ªçc hi·ªán t·∫°i: 'all', 'active', 'completed'
          this.currentSort = "newest"; // C√°ch s·∫Øp x·∫øp hi·ªán t·∫°i: 'newest', 'oldest', 'az', 'za'
          this.searchQuery = ""; // T·ª´ kh√≥a t√¨m ki·∫øm (chu·ªói r·ªóng l√† kh√¥ng t√¨m)
          this.isDarkMode = false; // Tr·∫°ng th√°i ch·∫ø ƒë·ªô t·ªëi (false = s√°ng)
          this.init(); // G·ªçi h√†m init() ƒë·ªÉ b·∫Øt ƒë·∫ßu
        }

        // H√†m init() d√πng ƒë·ªÉ kh·ªüi ƒë·ªông ·ª©ng d·ª•ng: l·∫•y d·ªØ li·ªáu ƒë√£ l∆∞u, v·∫Ω giao di·ªán, g·∫Øn s·ª± ki·ªán
        init() {
          this.loadFromLocalStorage(); // ƒê·ªçc d·ªØ li·ªáu t·ª´ localStorage (tr√¨nh duy·ªát) n·∫øu c√≥
          this.render(); // V·∫Ω danh s√°ch c√¥ng vi·ªác l√™n m√†n h√¨nh
          this.setupEventListeners(); // G·∫Øn c√°c s·ª± ki·ªán cho c√°c n√∫t b·∫•m
        }

        // H√†m g·∫Øn s·ª± ki·ªán cho c√°c ph·∫ßn t·ª≠ tr√™n giao di·ªán (n√∫t th√™m, l·ªçc, s·∫Øp x·∫øp, ...)
        setupEventListeners() {
          // ---- N√∫t th√™m c√¥ng vi·ªác ----
          document
            .getElementById("addButton")
            .addEventListener("click", () => this.addTodo());
          // √î nh·∫≠p li·ªáu: n·∫øu nh·∫•n ph√≠m Enter th√¨ c≈©ng th√™m c√¥ng vi·ªác
          document
            .getElementById("todoInput")
            .addEventListener("keypress", (e) => {
              if (e.key === "Enter") this.addTodo();
            });

          // ---- C√°c n√∫t l·ªçc (All, Active, Completed) ----
          // L·∫•y t·∫•t c·∫£ c√°c ph·∫ßn t·ª≠ c√≥ class 'filter-btn' v√† g√°n s·ª± ki·ªán click cho t·ª´ng c√°i
          document.querySelectorAll(".filter-btn").forEach((btn) => {
            btn.addEventListener("click", (e) => {
              // e.target l√† n√∫t v·ª´a ƒë∆∞·ª£c click, l·∫•y thu·ªôc t√≠nh data-filter c·ªßa n√≥
              this.setFilter(e.target.dataset.filter);
            });
          });

          // ---- C√°c n√∫t s·∫Øp x·∫øp (Newest, Oldest, A-Z, Z-A) ----
          document.querySelectorAll(".sort-btn").forEach((btn) => {
            btn.addEventListener("click", (e) => {
              this.setSort(e.target.dataset.sort);
            });
          });

          // ---- √î t√¨m ki·∫øm ----
          document
            .getElementById("searchInput")
            .addEventListener("input", (e) => {
              // L·∫•y gi√° tr·ªã nh·∫≠p v√†o, chuy·ªÉn th√†nh ch·ªØ th∆∞·ªùng ƒë·ªÉ d·ªÖ so s√°nh
              this.searchQuery = e.target.value.toLowerCase();
              this.render(); // V·∫Ω l·∫°i danh s√°ch sau khi c·∫≠p nh·∫≠t t·ª´ kh√≥a
            });

          // ---- N√∫t x√≥a c√°c c√¥ng vi·ªác ƒë√£ ho√†n th√†nh ----
          document
            .getElementById("clearCompleted")
            .addEventListener("click", () => {
              this.clearCompleted();
            });

          // ---- N√∫t chuy·ªÉn ƒë·ªïi theme (s√°ng/t·ªëi) ----
          document
            .getElementById("themeToggle")
            .addEventListener("click", () => {
              this.toggleTheme();
            });

          // ---- N√∫t xu·∫•t d·ªØ li·ªáu (Export) ----
          document.getElementById("exportBtn").addEventListener("click", () => {
            this.exportTodos();
          });

          // ---- N√∫t nh·∫≠p d·ªØ li·ªáu (Import) ----
          document.getElementById("importBtn").addEventListener("click", () => {
            this.importTodos();
          });
        }

        // ---------- C√ÅC H√ÄM X·ª¨ L√ù C√îNG VI·ªÜC (CRUD) ----------

        /**
         * Th√™m m·ªôt c√¥ng vi·ªác m·ªõi.
         * L·∫•y n·ªôi dung t·ª´ √¥ input, t·∫°o ƒë·ªëi t∆∞·ª£ng c√¥ng vi·ªác, th√™m v√†o m·∫£ng todos,
         * l∆∞u l·∫°i v√† v·∫Ω l·∫°i giao di·ªán.
         */
        addTodo() {
          const input = document.getElementById("todoInput");
          const text = input.value.trim(); // Lo·∫°i b·ªè kho·∫£ng tr·∫Øng ƒë·∫ßu cu·ªëi

          if (text === "") return; // N·∫øu r·ªóng th√¨ kh√¥ng l√†m g√¨

          // T·∫°o m·ªôt ƒë·ªëi t∆∞·ª£ng c√¥ng vi·ªác
          const newTodo = {
            id: Date.now(), // ID duy nh·∫•t d·ª±a tr√™n th·ªùi gian hi·ªán t·∫°i (s·ªë mili gi√¢y)
            text: text, // N·ªôi dung c√¥ng vi·ªác
            completed: false, // M·∫∑c ƒë·ªãnh ch∆∞a ho√†n th√†nh
            createdAt: new Date().toISOString(), // Th·ªùi gian t·∫°o (chu·∫©n ISO)
          };

          this.todos.push(newTodo); // Th√™m v√†o cu·ªëi m·∫£ng
          this.saveToLocalStorage(); // L∆∞u v√†o localStorage
          input.value = ""; // X√≥a √¥ input
          this.render(); // V·∫Ω l·∫°i danh s√°ch
        }

        /**
         * X√≥a m·ªôt c√¥ng vi·ªác theo id.
         * @param {number} id - ID c·ªßa c√¥ng vi·ªác c·∫ßn x√≥a
         */
        deleteTodo(id) {
          // L·ªçc m·∫£ng: gi·ªØ l·∫°i c√°c c√¥ng vi·ªác c√≥ id kh√°c v·ªõi id c·∫ßn x√≥a
          this.todos = this.todos.filter((todo) => todo.id !== id);
          this.saveToLocalStorage();
          this.render();
        }

        /**
         * ƒê√°nh d·∫•u ho√†n th√†nh / ch∆∞a ho√†n th√†nh cho c√¥ng vi·ªác.
         * @param {number} id - ID c·ªßa c√¥ng vi·ªác
         */
        toggleCompleted(id) {
          // T√¨m c√¥ng vi·ªác c√≥ id t∆∞∆°ng ·ª©ng
          const todo = this.todos.find((t) => t.id === id);
          if (todo) {
            todo.completed = !todo.completed; // ƒê·∫£o ng∆∞·ª£c tr·∫°ng th√°i
            this.saveToLocalStorage();
            this.render();
          }
        }

        /**
         * S·ª≠a n·ªôi dung c√¥ng vi·ªác (d√πng h·ªôp tho·∫°i prompt).
         * @param {number} id - ID c·ªßa c√¥ng vi·ªác c·∫ßn s·ª≠a
         */
        editTodo(id) {
          const todo = this.todos.find((t) => t.id === id);
          if (!todo) return;

          // Hi·ªÉn th·ªã h·ªôp tho·∫°i v·ªõi n·ªôi dung hi·ªán t·∫°i
          const newText = prompt("Edit todo:", todo.text);
          // N·∫øu ng∆∞·ªùi d√πng kh√¥ng nh·∫•n Cancel v√† nh·∫≠p n·ªôi dung kh√¥ng r·ªóng
          if (newText !== null && newText.trim() !== "") {
            todo.text = newText.trim();
            this.saveToLocalStorage();
            this.render();
          }
        }

        // ---------- C√ÅC H√ÄM X·ª¨ L√ù L·ªåC, S·∫ÆP X·∫æP, T√åM KI·∫æM ----------

        /**
         * Thi·∫øt l·∫≠p b·ªô l·ªçc hi·ªán t·∫°i v√† c·∫≠p nh·∫≠t class 'active' cho c√°c n√∫t.
         * @param {string} filter - Gi√° tr·ªã filter: 'all', 'active', 'completed'
         */
        setFilter(filter) {
          this.currentFilter = filter;
          // C·∫≠p nh·∫≠t class 'active' cho c√°c n√∫t filter
          document.querySelectorAll(".filter-btn").forEach((btn) => {
            // N·∫øu data-filter c·ªßa n√∫t tr√πng v·ªõi filter hi·ªán t·∫°i th√¨ th√™m class active, ng∆∞·ª£c l·∫°i b·ªè
            btn.classList.toggle("active", btn.dataset.filter === filter);
          });
          this.render(); // V·∫Ω l·∫°i danh s√°ch
        }

        /**
         * Thi·∫øt l·∫≠p ki·ªÉu s·∫Øp x·∫øp hi·ªán t·∫°i v√† c·∫≠p nh·∫≠t class 'active' cho c√°c n√∫t.
         * @param {string} sort - Ki·ªÉu s·∫Øp x·∫øp: 'newest', 'oldest', 'az', 'za'
         */
        setSort(sort) {
          this.currentSort = sort;
          document.querySelectorAll(".sort-btn").forEach((btn) => {
            btn.classList.toggle("active", btn.dataset.sort === sort);
          });
          this.render();
        }

        /**
         * L·∫•y danh s√°ch c√¥ng vi·ªác sau khi ƒë√£ √°p d·ª•ng b·ªô l·ªçc v√† s·∫Øp x·∫øp.
         * @returns {Array} M·∫£ng c√°c c√¥ng vi·ªác ƒë√£ ƒë∆∞·ª£c l·ªçc v√† s·∫Øp x·∫øp
         */
        getFilteredAndSortedTodos() {
          // ---- B∆Ø·ªöC 1: L·ªçc theo tr·∫°ng th√°i (all, active, completed) ----
          let filtered = this.todos; // B·∫Øt ƒë·∫ßu t·ª´ t·∫•t c·∫£ c√¥ng vi·ªác

          switch (this.currentFilter) {
            case "active":
              // L·ªçc nh·ªØng c√¥ng vi·ªác c√≥ completed = false
              filtered = this.todos.filter((todo) => !todo.completed);
              break;
            case "completed":
              // L·ªçc nh·ªØng c√¥ng vi·ªác c√≥ completed = true
              filtered = this.todos.filter((todo) => todo.completed);
              break;
            // 'all' kh√¥ng c·∫ßn l·ªçc, gi·ªØ nguy√™n
          }

          // ---- B∆Ø·ªöC 2: L·ªçc theo t·ª´ kh√≥a t√¨m ki·∫øm (n·∫øu c√≥) ----
          if (this.searchQuery) {
            // Ch·ªâ gi·ªØ l·∫°i c√°c c√¥ng vi·ªác c√≥ text ch·ª©a t·ª´ kh√≥a (kh√¥ng ph√¢n bi·ªát hoa/th∆∞·ªùng)
            filtered = filtered.filter((todo) =>
              todo.text.toLowerCase().includes(this.searchQuery),
            );
          }

          // ---- B∆Ø·ªöC 3: S·∫Øp x·∫øp theo ti√™u ch√≠ ----
          switch (this.currentSort) {
            case "newest":
              // S·∫Øp x·∫øp theo th·ªùi gian t·∫°o gi·∫£m d·∫ßn (m·ªõi nh·∫•t l√™n ƒë·∫ßu)
              filtered.sort(
                (a, b) => new Date(b.createdAt) - new Date(a.createdAt),
              );
              break;
            case "oldest":
              // S·∫Øp x·∫øp theo th·ªùi gian t·∫°o tƒÉng d·∫ßn (c≈© nh·∫•t l√™n ƒë·∫ßu)
              filtered.sort(
                (a, b) => new Date(a.createdAt) - new Date(b.createdAt),
              );
              break;
            case "az":
              // S·∫Øp x·∫øp theo b·∫£ng ch·ªØ c√°i A-Z (d√πng localeCompare ƒë·ªÉ so s√°nh chu·ªói)
              filtered.sort((a, b) => a.text.localeCompare(b.text));
              break;
            case "za":
              // S·∫Øp x·∫øp Z-A (ƒë·∫£o ng∆∞·ª£c c·ªßa A-Z)
              filtered.sort((a, b) => b.text.localeCompare(a.text));
              break;
          }

          return filtered;
        }

        /**
         * X√≥a t·∫•t c·∫£ c√¥ng vi·ªác ƒë√£ ho√†n th√†nh (sau khi x√°c nh·∫≠n).
         */
        clearCompleted() {
          // Ki·ªÉm tra xem c√≥ √≠t nh·∫•t m·ªôt c√¥ng vi·ªác ƒë√£ ho√†n th√†nh kh√¥ng
          if (this.todos.some((todo) => todo.completed)) {
            // some() tr·∫£ v·ªÅ true n·∫øu c√≥ √≠t nh·∫•t m·ªôt ph·∫ßn t·ª≠ th·ªèa m√£n
            if (confirm("Delete all completed todos?")) {
              // L·ªçc gi·ªØ l·∫°i nh·ªØng c√¥ng vi·ªác ch∆∞a ho√†n th√†nh
              this.todos = this.todos.filter((todo) => !todo.completed);
              this.saveToLocalStorage();
              this.render();
            }
          } else {
            alert("No completed todos to clear!");
          }
        }

        // ---------- C√ÅC H√ÄM CH·ª®C NƒÇNG PH·ª§ (THEME, XU·∫§T/NH·∫¨P) ----------

        /**
         * Chuy·ªÉn ƒë·ªïi gi·ªØa ch·∫ø ƒë·ªô s√°ng v√† t·ªëi.
         */
        toggleTheme() {
          this.isDarkMode = !this.isDarkMode; // ƒê·∫£o ng∆∞·ª£c tr·∫°ng th√°i
          // Th√™m ho·∫∑c x√≥a class 'dark-mode' tr√™n th·∫ª body
          document.body.classList.toggle("dark-mode", this.isDarkMode);
          // C·∫≠p nh·∫≠t n·ªôi dung n√∫t theme
          document.getElementById("themeToggle").textContent = this.isDarkMode
            ? "‚òÄÔ∏è Light Mode"
            : "üåô Dark Mode";
          this.saveToLocalStorage(); // L∆∞u l·∫°i l·ª±a ch·ªçn theme
        }

        /**
         * Xu·∫•t danh s√°ch c√¥ng vi·ªác ra file JSON.
         * T·∫°o m·ªôt file ch·ª©a d·ªØ li·ªáu todos d∆∞·ªõi d·∫°ng JSON v√† t·∫£i xu·ªëng.
         */
        exportTodos() {
          // JSON.stringify chuy·ªÉn m·∫£ng todos th√†nh chu·ªói JSON, tham s·ªë null, 2 ƒë·ªÉ format ƒë·∫πp
          const data = JSON.stringify(this.todos, null, 2);
          // T·∫°o m·ªôt ƒë·ªëi t∆∞·ª£ng Blob (t·∫≠p tin nh·ªã ph√¢n) t·ª´ chu·ªói JSON
          const blob = new Blob([data], { type: "application/json" });
          // T·∫°o m·ªôt URL t·∫°m th·ªùi cho blob
          const url = URL.createObjectURL(blob);
          // T·∫°o th·∫ª a ·∫©n ƒë·ªÉ k√≠ch ho·∫°t t·∫£i xu·ªëng
          const a = document.createElement("a");
          a.href = url;
          a.download = `todos-${new Date().toISOString().slice(0, 10)}.json`; // T√™n file theo ng√†y
          a.click(); // Gi·∫£ l·∫≠p click ƒë·ªÉ t·∫£i
          // Gi·∫£i ph√≥ng URL t·∫°m th·ªùi
          URL.revokeObjectURL(url);
        }

        /**
         * Nh·∫≠p danh s√°ch c√¥ng vi·ªác t·ª´ file JSON (thay th·∫ø d·ªØ li·ªáu hi·ªán t·∫°i).
         * M·ªü h·ªôp tho·∫°i ch·ªçn file, ƒë·ªçc n·ªôi dung v√† c·∫≠p nh·∫≠t todos.
         */
        importTodos() {
          // T·∫°o m·ªôt th·∫ª input file ·∫©n
          const input = document.createElement("input");
          input.type = "file";
          input.accept = ".json"; // Ch·ªâ ch·∫•p nh·∫≠n file .json

          // Khi ng∆∞·ªùi d√πng ch·ªçn file
          input.onchange = (e) => {
            const file = e.target.files[0]; // L·∫•y file ƒë·∫ßu ti√™n
            if (!file) return;

            // T·∫°o ƒë·ªëi t∆∞·ª£ng FileReader ƒë·ªÉ ƒë·ªçc file
            const reader = new FileReader();
            reader.onload = (event) => {
              try {
                // Parse n·ªôi dung file th√†nh m·∫£ng c√°c todo
                const importedTodos = JSON.parse(event.target.result);

                // Ki·ªÉm tra d·ªØ li·ªáu c√≥ ƒë√∫ng ƒë·ªãnh d·∫°ng kh√¥ng
                // M·ªói todo ph·∫£i c√≥ id, text v√† completed
                const isValid = importedTodos.every(
                  (todo) =>
                    todo.id && todo.text && todo.completed !== undefined,
                );

                if (isValid) {
                  if (confirm("Replace current todos with imported data?")) {
                    this.todos = importedTodos; // G√°n m·∫£ng m·ªõi
                    this.saveToLocalStorage();
                    this.render();
                    alert("Import successful!");
                  }
                } else {
                  alert("Invalid file format!");
                }
              } catch (error) {
                alert("Error importing file!");
              }
            };
            reader.readAsText(file); // ƒê·ªçc file d∆∞·ªõi d·∫°ng vƒÉn b·∫£n
          };

          input.click(); // M·ªü h·ªôp tho·∫°i ch·ªçn file
        }

        // ---------- H√ÄM V·∫º GIAO DI·ªÜN (RENDER) ----------

        /**
         * V·∫Ω l·∫°i danh s√°ch c√¥ng vi·ªác l√™n HTML d·ª±a tr√™n d·ªØ li·ªáu hi·ªán t·∫°i.
         */
        render() {
          const todoList = document.getElementById("todoList");
          // L·∫•y danh s√°ch ƒë√£ l·ªçc v√† s·∫Øp x·∫øp
          const filteredTodos = this.getFilteredAndSortedTodos();

          // N·∫øu kh√¥ng c√≥ c√¥ng vi·ªác n√†o sau khi l·ªçc, hi·ªÉn th·ªã "empty state"
          if (filteredTodos.length === 0) {
            const hasSearch = this.searchQuery.length > 0;
            const hasTodos = this.todos.length > 0;

            todoList.innerHTML = `
                        <div class="empty-state">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                            </svg>
                            <p>${hasSearch ? "No todos match your search" : hasTodos ? "No todos match the filter" : "No todos yet! üòä"}</p>
                        </div>
                    `;
          } else {
            // D√πng map ƒë·ªÉ t·∫°o chu·ªói HTML cho t·ª´ng todo, sau ƒë√≥ n·ªëi l·∫°i b·∫±ng join('')
            todoList.innerHTML = filteredTodos
              .map(
                (todo) => `
                        <li class="todo-item" draggable="true" data-id="${todo.id}">
                            <input 
                                type="checkbox" 
                                class="todo-checkbox" 
                                ${todo.completed ? "checked" : ""}
                                onchange="todoApp.toggleCompleted(${todo.id})"
                            >
                            <span class="todo-text">${this.escapeHtml(todo.text)}</span>
                            <div class="todo-actions">
                                <button class="todo-btn edit-btn" onclick="todoApp.editTodo(${todo.id})">‚úèÔ∏è</button>
                                <button class="todo-btn delete-btn" onclick="todoApp.deleteTodo(${todo.id})">üóëÔ∏è</button>
                            </div>
                        </li>
                    `,
              )
              .join("");

            // Sau khi v·∫Ω xong, thi·∫øt l·∫≠p t√≠nh nƒÉng k√©o th·∫£
            this.setupDragAndDrop();
          }

          // C·∫≠p nh·∫≠t s·ªë li·ªáu th·ªëng k√™
          this.updateStats();
        }

        /**
         * Thi·∫øt l·∫≠p s·ª± ki·ªán k√©o th·∫£ cho c√°c c√¥ng vi·ªác (drag and drop).
         * Cho ph√©p ng∆∞·ªùi d√πng s·∫Øp x·∫øp l·∫°i th·ª© t·ª± c√¥ng vi·ªác b·∫±ng c√°ch k√©o th·∫£.
         */
        setupDragAndDrop() {
          const todoItems = document.querySelectorAll(".todo-item");
          let draggedItem = null; // L∆∞u ph·∫ßn t·ª≠ ƒëang ƒë∆∞·ª£c k√©o

          todoItems.forEach((item) => {
            // Khi b·∫Øt ƒë·∫ßu k√©o
            item.addEventListener("dragstart", () => {
              draggedItem = item;
              // Th√™m class 'dragging' sau m·ªôt kho·∫£ng th·ªùi gian r·∫•t ng·∫Øn (ƒë·ªÉ hi·ªáu ·ª©ng m∆∞·ª£t)
              setTimeout(() => item.classList.add("dragging"), 0);
            });

            // Khi k·∫øt th√∫c k√©o
            item.addEventListener("dragend", () => {
              draggedItem = null;
              item.classList.remove("dragging");
            });

            // Khi k√©o qua m·ªôt ph·∫ßn t·ª≠ kh√°c (s·ª± ki·ªán dragover c·∫ßn ngƒÉn ch·∫∑n m·∫∑c ƒë·ªãnh)
            item.addEventListener("dragover", (e) => {
              e.preventDefault(); // B·∫Øt bu·ªôc ƒë·ªÉ cho ph√©p drop
              // T√¨m v·ªã tr√≠ ƒë·ªÉ ch√®n draggedItem
              const afterElement = this.getDragAfterElement(
                todoList,
                e.clientY,
              );
              if (afterElement == null) {
                // N·∫øu kh√¥ng t√¨m th·∫•y ph·∫ßn t·ª≠ sau, ch√®n v√†o cu·ªëi danh s√°ch
                todoList.appendChild(draggedItem);
              } else {
                // Ch√®n tr∆∞·ªõc ph·∫ßn t·ª≠ afterElement
                todoList.insertBefore(draggedItem, afterElement);
              }
            });
          });
        }

        /**
         * H√†m ph·ª• tr·ª£ cho k√©o th·∫£: t√¨m ph·∫ßn t·ª≠ n·∫±m g·∫ßn v·ªã tr√≠ chu·ªôt nh·∫•t ƒë·ªÉ ch√®n v√†o tr∆∞·ªõc n√≥.
         * @param {HTMLElement} container - Danh s√°ch ul
         * @param {number} y - T·ªça ƒë·ªô Y c·ªßa chu·ªôt
         * @returns {HTMLElement} Ph·∫ßn t·ª≠ c·∫ßn ch√®n tr∆∞·ªõc, ho·∫∑c null n·∫øu ch√®n cu·ªëi
         */
        getDragAfterElement(container, y) {
          // L·∫•y t·∫•t c·∫£ c√°c ph·∫ßn t·ª≠ c√≥ th·ªÉ th·∫£ (kh√¥ng k·ªÉ ph·∫ßn t·ª≠ ƒëang k√©o)
          const draggableElements = [
            ...container.querySelectorAll(".todo-item:not(.dragging)"),
          ];

          // D√πng reduce ƒë·ªÉ t√¨m ph·∫ßn t·ª≠ c√≥ kho·∫£ng c√°ch g·∫ßn nh·∫•t ph√≠a tr√™n chu·ªôt
          return draggableElements.reduce(
            (closest, child) => {
              const box = child.getBoundingClientRect(); // L·∫•y v·ªã tr√≠ v√† k√≠ch th∆∞·ªõc c·ªßa child
              const offset = y - box.top - box.height / 2; // Kho·∫£ng c√°ch t·ª´ chu·ªôt ƒë·∫øn t√¢m child
              // N·∫øu offset √¢m (chu·ªôt ·ªü tr√™n t√¢m) v√† offset l·ªõn h∆°n closest.offset (g·∫ßn h∆°n)
              if (offset < 0 && offset > closest.offset) {
                return { offset: offset, element: child };
              } else {
                return closest;
              }
            },
            { offset: Number.NEGATIVE_INFINITY },
          ).element; // Kh·ªüi t·∫°o v·ªõi offset √¢m v√¥ c√πng
        }

        /**
         * C·∫≠p nh·∫≠t s·ªë li·ªáu th·ªëng k√™: t·ªïng s·ªë, ƒë√£ ho√†n th√†nh, ch∆∞a ho√†n th√†nh.
         */
        updateStats() {
          const total = this.todos.length;
          const completed = this.todos.filter((t) => t.completed).length;
          const active = total - completed;

          document.getElementById("totalCount").textContent = `Total: ${total}`;
          document.getElementById("completedCount").textContent =
            `Completed: ${completed}`;
          document.getElementById("activeCount").textContent =
            `Active: ${active}`;
        }

        // ---------- L∆ØU TR·ªÆ LOCALSTORAGE ----------

        /**
         * L∆∞u d·ªØ li·ªáu (todos v√† tr·∫°ng th√°i theme) v√†o localStorage.
         * localStorage l√† n∆°i l∆∞u tr·ªØ vƒ©nh vi·ªÖn tr√™n tr√¨nh duy·ªát, kh√¥ng b·ªã m·∫•t khi t·∫£i l·∫°i trang.
         */
        saveToLocalStorage() {
          const data = {
            todos: this.todos,
            isDarkMode: this.isDarkMode,
          };
          // localStorage ch·ªâ l∆∞u ƒë∆∞·ª£c chu·ªói, n√™n d√πng JSON.stringify ƒë·ªÉ chuy·ªÉn object th√†nh chu·ªói
          localStorage.setItem("todos_v2", JSON.stringify(data));

          // ƒê·ªìng th·ªùi √°p d·ª•ng theme cho body (ph√≤ng khi g·ªçi t·ª´ n∆°i kh√°c)
          document.body.classList.toggle("dark-mode", this.isDarkMode);
        }

        /**
         * ƒê·ªçc d·ªØ li·ªáu t·ª´ localStorage v√† c·∫≠p nh·∫≠t v√†o ·ª©ng d·ª•ng.
         * N·∫øu ch∆∞a c√≥ d·ªØ li·ªáu, gi·ªØ nguy√™n m·∫£ng r·ªóng.
         */
        loadFromLocalStorage() {
          const saved = localStorage.getItem("todos_v2");
          if (saved) {
            const data = JSON.parse(saved); // Chuy·ªÉn chu·ªói JSON th√†nh object
            this.todos = data.todos || []; // N·∫øu c√≥ todos th√¨ g√°n, kh√¥ng th√¨ m·∫£ng r·ªóng
            this.isDarkMode = data.isDarkMode || false;

            // √Åp d·ª•ng theme ƒë√£ l∆∞u
            if (this.isDarkMode) {
              document.body.classList.add("dark-mode");
              document.getElementById("themeToggle").textContent =
                "‚òÄÔ∏è Light Mode";
            } else {
              document.getElementById("themeToggle").textContent =
                "üåô Dark Mode";
            }
          }
        }

        /**
         * H√†m ph√≤ng ng·ª´a t·∫•n c√¥ng XSS (Cross-Site Scripting).
         * Chuy·ªÉn c√°c k√Ω t·ª± ƒë·∫∑c bi·ªát trong text th√†nh th·ª±c th·ªÉ HTML ƒë·ªÉ kh√¥ng b·ªã hi·ªÉu l√† m√£.
         * @param {string} text - N·ªôi dung c·∫ßn tho√°t HTML
         * @returns {string} N·ªôi dung an to√†n ƒë·ªÉ ch√®n v√†o HTML
         */
        escapeHtml(text) {
          const div = document.createElement("div");
          div.textContent = text; // G√°n n·ªôi dung, tr√¨nh duy·ªát t·ª± ƒë·ªông escape
          return div.innerHTML; // L·∫•y l·∫°i n·ªôi dung ƒë√£ ƒë∆∞·ª£c escape
        }
      }

      // --- K·∫æT TH√öC CLASS ---

      // T·∫°o m·ªôt ƒë·ªëi t∆∞·ª£ng todoApp t·ª´ class TodoApp.
      // L√∫c n√†y constructor s·∫Ω ch·∫°y v√† ·ª©ng d·ª•ng b·∫Øt ƒë·∫ßu ho·∫°t ƒë·ªông.
      const todoApp = new TodoApp();
    </script>
  </body>
</html>
