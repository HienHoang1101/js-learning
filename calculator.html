<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Calculator v2.0 - Functions Practice</title>
    <style>
      /* Reset CSS - X√≥a m·ªçi margin, padding m·∫∑c ƒë·ªãnh c·ªßa tr√¨nh duy·ªát */
      *,
      *::before,
      *::after {
        margin: 0;
        padding: 0;
        box-sizing: border-box; /* Padding v√† border t√≠nh TRONG width */
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        display: flex; /* Flexbox ƒë·ªÉ cƒÉn gi·ªØa */
        justify-content: center; /* CƒÉn gi·ªØa theo chi·ªÅu ngang */
        align-items: center; /* CƒÉn gi·ªØa theo chi·ªÅu d·ªçc */
        min-height: 100vh; /* Chi·ªÅu cao t·ªëi thi·ªÉu = 100% viewport */
        background: linear-gradient(135deg, #b4b4b4 0%, #71748e 100%);
        padding: 20px;
      }

      /* Container ch·ª©a c·∫£ calculator v√† history panel */
      .calculator-container {
        display: flex;
        gap: 20px; /* Kho·∫£ng c√°ch gi·ªØa 2 panels */
        flex-wrap: wrap; /* Xu·ªëng h√†ng n·∫øu m√†n h√¨nh nh·ªè */
        justify-content: center;
      }

      /* Khung m√°y t√≠nh */
      .calculator {
        background: white;
        padding: 30px;
        border-radius: 15px;
        box-shadow: 0 15px 50px rgba(0, 0, 0, 0.3); /* ƒê·ªï b√≥ng */
        width: 320px;
      }

      /* Khung l·ªãch s·ª≠ b√™n ph·∫£i */
      .history-panel {
        background: white;
        padding: 20px;
        border-radius: 15px;
        box-shadow: 0 15px 50px rgba(0, 0, 0, 0.3);
        width: 280px;
        max-height: 500px; /* Chi·ªÅu cao t·ªëi ƒëa */
        overflow-y: auto; /* Scroll khi qu√° cao */
      }

      h1 {
        text-align: center;
        color: #333;
        margin-bottom: 20px;
        font-size: 28px;
      }

      h2 {
        color: #2f23d6;
        margin-bottom: 15px;
        font-size: 20px;
        border-bottom: 2px solid #2f23d6; /* G·∫°ch ch√¢n */
        padding-bottom: 8px;
      }

      /* M√†n h√¨nh hi·ªÉn th·ªã k·∫øt qu·∫£ */
      .display {
        width: 100%;
        padding: 20px;
        margin: 10px 0;
        font-size: 28px;
        text-align: right; /* CƒÉn ph·∫£i nh∆∞ m√°y t√≠nh th·∫≠t */
        border: 2px solid #ddd;
        border-radius: 8px;
        background: #f8f9fa;
        color: #333;
        font-weight: bold;
      }

      /* Danh s√°ch l·ªãch s·ª≠ */
      .history-list {
        list-style: none; /* B·ªè d·∫•u ch·∫•m ƒë·∫ßu d√≤ng */
        max-height: 400px;
        overflow-y: auto; /* Scroll n·∫øu qu√° nhi·ªÅu */
      }

      /* M·ªói item trong l·ªãch s·ª≠ */
      .history-item {
        padding: 10px;
        margin-bottom: 8px;
        background: #f8f9fa;
        border-radius: 5px;
        border-left: 4px solid #2f23d6; /* Vi·ªÅn tr√°i ƒë·ªÉ nh·∫•n m·∫°nh */
        font-family: monospace; /* Font code ƒë·ªÉ d·ªÖ ƒë·ªçc */
        transition: transform 0.2s; /* Hi·ªáu ·ª©ng chuy·ªÉn ƒë·ªông m∆∞·ª£t */
      }

      /* Hi·ªáu ·ª©ng khi hover v√†o history item */
      .history-item:hover {
        transform: translateX(5px); /* D·ªãch sang ph·∫£i 5px */
        background: #e9ecef;
      }

      .history-item .expression {
        color: #666;
        font-size: 14px;
      }

      .history-item .result {
        color: #28a745; /* M√†u xanh l√° cho k·∫øt qu·∫£ */
        font-weight: bold;
        font-size: 16px;
        margin-top: 3px;
      }

      /* Grid layout cho c√°c n√∫t b·∫•m */
      .buttons {
        display: grid;
        grid-template-columns: repeat(4, 1fr); /* 4 c·ªôt b·∫±ng nhau */
        gap: 10px; /* Kho·∫£ng c√°ch gi·ªØa c√°c n√∫t */
        margin-top: 15px;
      }

      /* Style chung cho t·∫•t c·∫£ buttons */
      button {
        padding: 18px 10px;
        font-size: 18px;
        border: none;
        border-radius: 8px;
        cursor: pointer; /* Con tr·ªè chu·ªôt d·∫°ng b√†n tay */
        background: #131224;
        color: white;
        font-weight: 600;
        transition: all 0.3s; /* Hi·ªáu ·ª©ng m∆∞·ª£t cho m·ªçi thay ƒë·ªïi */
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      }

      /* Hi·ªáu ·ª©ng khi hover */
      button:hover {
        background: #56515b;
        transform: translateY(-2px); /* N·ªïi l√™n 2px */
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); /* B√≥ng ƒë·∫≠m h∆°n */
      }

      /* Hi·ªáu ·ª©ng khi click */
      button:active {
        transform: translateY(0); /* Tr·ªü v·ªÅ v·ªã tr√≠ ban ƒë·∫ßu */
      }

      /* C√°c n√∫t to√°n t·ª≠ (+, -, *, /) */
      button.operator {
        background: #3d3990;
      }

      button.operator:hover {
        background: #786596;
      }

      /* N√∫t b·∫±ng (=) */
      button.equals {
        background: #4facfe;
        grid-column: span 2; /* Chi·∫øm 2 c·ªôt */
      }

      button.equals:hover {
        background: #3d9be9;
      }

      /* N√∫t x√≥a (CE, AC) */
      button.clear {
        background: #ff758c;
      }

      button.clear:hover {
        background: #ff5269;
      }

      /* N√∫t b·ªô nh·ªõ (M+, MR, MC) */
      button.memory {
        background: #ffcc80;
      }

      button.memory:hover {
        background: #ffb74d;
      }

      /* Hi·ªÉn th·ªã b·ªô nh·ªõ */
      .memory-display {
        width: 100%;
        padding: 10px;
        margin: 10px 0;
        font-size: 14px;
        text-align: right;
        border: 1px solid #ddd;
        border-radius: 5px;
        background: #e3f2fd;
        color: #1976d2;
        display: none; /* ·∫®n m·∫∑c ƒë·ªãnh, ch·ªâ hi·ªán khi c√≥ memory */
      }

      /* N√∫t AC (All Clear) */
      .clear-all {
        grid-column: span 2; /* Chi·∫øm 2 c·ªôt */
        background: #a0aec0;
      }

      .clear-all:hover {
        background: #718096;
      }
    </style>
  </head>
  <body>
    <div class="calculator-container">
      <div class="calculator">
        <h1>üßÆ Calculator v2.0</h1>
        <!-- Hi·ªÉn th·ªã gi√° tr·ªã memory (M: 0) -->
        <div class="memory-display" id="memoryDisplay">M: 0</div>
        <!-- M√†n h√¨nh hi·ªÉn th·ªã k·∫øt qu·∫£ -->
        <input
          type="text"
          id="display"
          class="display"
          disabled
          placeholder="0"
        />
        <div class="buttons">
          <!-- CE: Clear Entry - X√≥a s·ªë hi·ªán t·∫°i -->
          <button class="clear" onclick="calculator.clearEntry()">CE</button>
          <!-- AC: All Clear - X√≥a t·∫•t c·∫£ -->
          <button class="clear-all" onclick="calculator.clearAll()">AC</button>
          <!-- Backspace: X√≥a k√Ω t·ª± cu·ªëi -->
          <button class="operator" onclick="calculator.backspace()">‚å´</button>
          <button class="operator" onclick="calculator.appendOperator('/')">
            /
          </button>

          <button onclick="calculator.appendNumber('7')">7</button>
          <button onclick="calculator.appendNumber('8')">8</button>
          <button onclick="calculator.appendNumber('9')">9</button>
          <button class="operator" onclick="calculator.appendOperator('*')">
            √ó
          </button>

          <button onclick="calculator.appendNumber('4')">4</button>
          <button onclick="calculator.appendNumber('5')">5</button>
          <button onclick="calculator.appendNumber('6')">6</button>
          <button class="operator" onclick="calculator.appendOperator('-')">
            -
          </button>

          <button onclick="calculator.appendNumber('1')">1</button>
          <button onclick="calculator.appendNumber('2')">2</button>
          <button onclick="calculator.appendNumber('3')">3</button>
          <button class="operator" onclick="calculator.appendOperator('+')">
            +
          </button>

          <button onclick="calculator.appendNumber('0')">0</button>
          <button onclick="calculator.appendNumber('.')">.</button>
          <!-- M+: Memory Add - L∆∞u v√†o b·ªô nh·ªõ -->
          <button class="memory" onclick="calculator.memoryStore()">M+</button>
          <!-- MR: Memory Recall - L·∫•y t·ª´ b·ªô nh·ªõ -->
          <button class="memory" onclick="calculator.memoryRecall()">MR</button>

          <button class="equals" onclick="calculator.calculate()">=</button>
          <!-- MC: Memory Clear - X√≥a b·ªô nh·ªõ -->
          <button class="memory" onclick="calculator.memoryClear()">MC</button>
        </div>
      </div>

      <!-- Panel l·ªãch s·ª≠ b√™n ph·∫£i -->
      <div class="history-panel">
        <h2>üìù History</h2>
        <ul id="historyList" class="history-list">
          <!-- History items s·∫Ω ƒë∆∞·ª£c JavaScript th√™m v√†o ƒë√¢y -->
        </ul>
      </div>
    </div>

    <script>
      // OBJECT CALCULATOR - T·ªï ch·ª©c t·∫•t c·∫£ logic v√†o 1 object
      const calculator = {
        // PROPERTIES - C√°c thu·ªôc t√≠nh l∆∞u tr·∫°ng th√°i
        displayValue: "0", // Gi√° tr·ªã hi·ªÉn th·ªã tr√™n m√†n h√¨nh
        firstOperand: null, // S·ªë th·ª© nh·∫•t trong ph√©p t√≠nh
        waitingForSecondOperand: false, // ƒêang ch·ªù nh·∫≠p s·ªë th·ª© 2?
        operator: null, // To√°n t·ª≠ hi·ªán t·∫°i (+, -, *, /)
        history: [], // M·∫£ng l∆∞u l·ªãch s·ª≠ t√≠nh to√°n
        memory: 0, // B·ªô nh·ªõ calculator

        // METHOD: C·∫≠p nh·∫≠t m√†n h√¨nh hi·ªÉn th·ªã
        updateDisplay() {
          document.getElementById("display").value = this.displayValue;
        },

        // METHOD: Th√™m s·ªë v√†o display
        appendNumber(number) {
          // N·∫øu ƒëang ch·ªù s·ªë th·ª© 2, thay th·∫ø to√†n b·ªô display
          if (this.waitingForSecondOperand) {
            this.displayValue = number;
            this.waitingForSecondOperand = false;
          } else {
            // N·∫øu display l√† "0", thay th·∫ø b·∫±ng s·ªë m·ªõi
            // N·∫øu kh√¥ng, n·ªëi th√™m s·ªë v√†o cu·ªëi
            this.displayValue =
              this.displayValue === "0" ? number : this.displayValue + number;
          }
          this.updateDisplay();
        },

        // METHOD: Th√™m to√°n t·ª≠ (+, -, *, /)
        appendOperator(nextOperator) {
          const inputValue = parseFloat(this.displayValue);

          // N·∫øu ch∆∞a c√≥ s·ªë th·ª© nh·∫•t, l∆∞u s·ªë hi·ªán t·∫°i v√†o firstOperand
          if (this.firstOperand === null) {
            this.firstOperand = inputValue;
          }
          // N·∫øu ƒë√£ c√≥ to√°n t·ª≠ v√† s·ªë th·ª© nh·∫•t, t√≠nh lu√¥n k·∫øt qu·∫£ tr∆∞·ªõc
          // VD: 5 + 3 * 2 ‚Üí T√≠nh 5+3=8 tr∆∞·ªõc, r·ªìi m·ªõi nh√¢n 2
          else if (this.operator) {
            const result = this.calculate(false); // false = kh√¥ng l∆∞u history
            this.displayValue = String(result);
            this.updateDisplay();
            this.firstOperand = result;
          }

          this.waitingForSecondOperand = true; // ƒê√°nh d·∫•u ƒëang ch·ªù s·ªë th·ª© 2
          this.operator = nextOperator; // L∆∞u to√°n t·ª≠
        },

        // METHOD: T√≠nh to√°n k·∫øt qu·∫£
        calculate(addToHistory = true) {
          // N·∫øu ch∆∞a c√≥ to√°n t·ª≠ ho·∫∑c ƒëang ch·ªù s·ªë th·ª© 2, return gi√° tr·ªã hi·ªán t·∫°i
          if (this.operator === null || this.waitingForSecondOperand) {
            return parseFloat(this.displayValue);
          }

          const secondOperand = parseFloat(this.displayValue);
          let result = 0;

          // Switch case ƒë·ªÉ x·ª≠ l√Ω t·ª´ng ph√©p t√≠nh
          switch (this.operator) {
            case "+":
              result = this.firstOperand + secondOperand;
              break;
            case "-":
              result = this.firstOperand - secondOperand;
              break;
            case "*":
              result = this.firstOperand * secondOperand;
              break;
            case "/":
              result = this.firstOperand / secondOperand;
              break;
            default:
              return; // Kh√¥ng l√†m g√¨ n·∫øu to√°n t·ª≠ kh√¥ng h·ª£p l·ªá
          }

          // L√†m tr√≤n ƒë·∫øn 6 ch·ªØ s·ªë th·∫≠p ph√¢n ƒë·ªÉ tr√°nh l·ªói floating point
          // VD: 0.1 + 0.2 = 0.30000000000000004 ‚Üí l√†m tr√≤n th√†nh 0.3
          result = Math.round(result * 1000000) / 1000000;

          // N·∫øu addToHistory = true, th√™m v√†o l·ªãch s·ª≠
          if (addToHistory) {
            const expression = `${this.firstOperand} ${this.operator} ${secondOperand}`;
            this.addToHistory(expression, result);
          }

          this.displayValue = String(result);
          this.updateDisplay();

          // Reset state ƒë·ªÉ chu·∫©n b·ªã cho ph√©p t√≠nh ti·∫øp theo
          this.firstOperand = result; // K·∫øt qu·∫£ tr·ªü th√†nh s·ªë th·ª© nh·∫•t
          this.waitingForSecondOperand = true;
          this.operator = null;

          return result;
        },

        // METHOD: X√≥a entry hi·ªán t·∫°i (CE - Clear Entry)
        clearEntry() {
          this.displayValue = "0";
          this.updateDisplay();
        },

        // METHOD: X√≥a t·∫•t c·∫£ (AC - All Clear)
        clearAll() {
          this.displayValue = "0";
          this.firstOperand = null;
          this.waitingForSecondOperand = false;
          this.operator = null;
          this.updateDisplay();
        },

        // METHOD: X√≥a k√Ω t·ª± cu·ªëi (Backspace)
        backspace() {
          if (this.displayValue.length > 1) {
            // C·∫Øt b·ªè k√Ω t·ª± cu·ªëi c√πng
            this.displayValue = this.displayValue.slice(0, -1);
          } else {
            // N·∫øu ch·ªâ c√≤n 1 k√Ω t·ª±, reset v·ªÅ "0"
            this.displayValue = "0";
          }
          this.updateDisplay();
        },

        // METHOD: Th√™m v√†o l·ªãch s·ª≠
        addToHistory(expression, result) {
          // unshift() = th√™m v√†o ƒê·∫¶U m·∫£ng (item m·ªõi nh·∫•t l√™n ƒë·∫ßu)
          this.history.unshift({ expression, result });

          // Gi·ªõi h·∫°n history ch·ªâ 20 items
          if (this.history.length > 20) {
            this.history.pop(); // X√≥a item cu·ªëi c√πng (c≈© nh·∫•t)
          }

          this.renderHistory(); // Render l·∫°i UI
        },

        // METHOD: Hi·ªÉn th·ªã l·ªãch s·ª≠ ra HTML
        renderHistory() {
          const historyList = document.getElementById("historyList");

          // map() = duy·ªát qua m·∫£ng history, t·∫°o HTML cho t·ª´ng item
          // join("") = n·ªëi c√°c chu·ªói HTML l·∫°i th√†nh 1 chu·ªói duy nh·∫•t
          historyList.innerHTML = this.history
            .map(
              (item) => `
                    <li class="history-item">
                        <div class="expression">${item.expression}</div>
                        <div class="result">= ${item.result}</div>
                    </li>
                `,
            )
            .join("");
        },

        // METHOD: M+ (Memory Store) - L∆∞u v√†o b·ªô nh·ªõ
        memoryStore() {
          this.memory = parseFloat(this.displayValue);
          this.updateMemoryDisplay();
        },

        // METHOD: MR (Memory Recall) - L·∫•y t·ª´ b·ªô nh·ªõ
        memoryRecall() {
          this.displayValue = String(this.memory);
          this.updateDisplay();
        },

        // METHOD: MC (Memory Clear) - X√≥a b·ªô nh·ªõ
        memoryClear() {
          this.memory = 0;
          this.updateMemoryDisplay();
        },

        // METHOD: C·∫≠p nh·∫≠t hi·ªÉn th·ªã memory
        updateMemoryDisplay() {
          const memoryDisplay = document.querySelector(".memory-display");

          // Ch·ªâ hi·ªÉn th·ªã khi memory kh√°c 0
          memoryDisplay.style.display = this.memory !== 0 ? "block" : "none";
          memoryDisplay.textContent = `M: ${this.memory}`;
        },
      };

      // KH·ªûI T·∫†O: Hi·ªÉn th·ªã "0" khi trang v·ª´a load
      calculator.updateDisplay();
    </script>
  </body>
</html>
